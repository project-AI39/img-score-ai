# アクティブラーニングによる好み判定モデルの学習フロー

このプロジェクトでは、「人間がすべての画像にラベル付けする」のではなく、「モデルに一度予測させて、間違いだけ人間が直す」というアクティブラーニング的なループで学習データを育てていきます。

## 1. 初期データの用意

まずは少量の、はっきりした好みだけを使って最初のモデルを作ります。

- 学習好き（positive）: 約 200 枚
  - 「確実に好き」と言える画像だけを厳選して集める
- 学習嫌い（negative）: 約 200 枚
  - 「少なくとも自分の求める雰囲気ではない」とはっきり言える画像を集める

ディレクトリ構成:

- `data/train/like/` … 好き画像（1）
- `data/train/dislike/` … 嫌い・刺さらない画像（0）

この 2 クラスで、CLIP 埋め込み → 好み度(0〜1) を出すヘッドを最初に学習します。

```bash
uv run python scripts/train.py
```

## 2. 未ラベル画像に対する自動予測

次に、まだラベルをつけていない画像に対して、学習済みモデルで好み度を予測します。

- 入力: `data/unlabeled/` に置いた画像群
- 出力:
  - 高スコア（例: 0.7 以上） → 「好き候補」
  - 低スコア（例: 0.3 以下） → 「嫌い候補」

ここではまだモデルの予測をそのまま信じず、「人間がチェックする候補リスト」を作るイメージです。

**分類スクリプトで振り分け:**

```bash
uv run python scripts/classify.py
```

**スコアレポートで確認:**

```bash
uv run python scripts/score.py
```

## 3. モデルの"間違い"だけを人間が修正

アクティブラーニングの肝は、「全部ラベル付けする」のではなく、「モデルが迷っている／間違えたサンプルだけ修正する」ことです。

具体的には:

- 「好き候補」（`data/classified/like/`）の中から:
  - 実際はあまり好きではない／むしろ嫌いな画像 → `data/train/dislike/` に移動（0 として追加）
- 「嫌い候補」（`data/classified/dislike/`）の中から:
  - 実はかなり好きな画像 → `data/train/like/` に移動（1 として追加）

つまり、「好きに分けられた嫌い」「嫌いに分けられた好き」だけを人間が見つけて、正しいクラスに入れ直します。  
これにより、モデルが苦手としている"境界付近のデータ"だけが効率よく増えていきます。

## 4. 追加データ込みで再学習

ラベルを修正・追加したら、`data/train/like` と `data/train/dislike` を使ってもう一度モデルを学習し直します。

```bash
uv run python scripts/train.py
```

- 新しいデータが増えるほど、「好きゾーン」と「そうでないゾーン」の境界がシャープになる
- 特に「似ているけど微妙に違う」ケースを多く含むようになり、好み度 0〜1 の精度が上がる

## 5. ループとして繰り返す

1〜4 を何回か繰り返すことで、

1. 初期: 好き 200 / 嫌い 200 のざっくり境界
2. 数サイクル後: 好き 500〜1000 / 嫌い 1000〜2000 程度に増え、
   - モデルがかなり安定して「好み度（0〜100%）」を出せるようになる

という流れを目指します。

## フローチャート

```
┌─────────────────────────────────────────────────────────────┐
│  1. 初期データ準備                                         　  │
│     data/train/like/    ← 好きな画像 200枚程度              　　│
│     data/train/dislike/ ← 嫌いな画像 200枚程度              　　│
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  2. 学習                                                     │
│     uv run python scripts/train.py                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 推論（未ラベル画像を分類）                              　　　│
│     data/unlabeled/ に画像を配置                            　 │
│     uv run python scripts/classify.py                       │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  4. 人間による修正                                          　 │
│     data/classified/like/   → 間違いを data/train/dislike/  　│
│     data/classified/dislike/→ 間違いを data/train/like/     　│
└─────────────────────────────────────────────────────────────┘
                              ↓
                    ┌─────────────┐
                    │ 2に戻って   　│
                    │ 再学習      　│
                    └─────────────┘
```

## コマンド一覧

| コマンド                             | 説明                                        |
| ------------------------------------ | ------------------------------------------- |
| `uv run python scripts/check_env.py` | 環境確認                                    |
| `uv run python scripts/train.py`     | モデル学習                                  |
| `uv run python scripts/classify.py`  | 画像分類（like/dislike フォルダに振り分け） |
| `uv run python scripts/score.py`     | スコアレポート出力（CSV 形式）              |
